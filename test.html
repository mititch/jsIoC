<!DOCTYPE html>
<html>
<body>

<h1>jsIoC test</h1>
<p>Open the browser console to see results</p>

</body>

<script src="jsioc.js"></script>
<script src="ctors.js"></script>
<script type="text/javascript">

    window.onload = function() {

        var trigger = false;

        function FakeCtorB (cont) {
            this.i = 0; 
            trigger = true;
            this.doB = function() {
                this.i++;
            };
        };
        FakeCtorB.interface = "interfaceB";

        function CtorC (cont) {
            this.doC = function() {
                return 'C';
            };
        };
        CtorC.interface = 'interfaceC';

        function CtorD (cont) {
            this.prop = {};
        };
        CtorD.interface = 'interfaceD';

        
        var testCont = new JSIOC.Container();
        testCont.Configure({
            'interfaceB': testCont.Singleton(FakeCtorB),
            'interfaceC': testCont.Singleton(CtorC),
            'interfaceD': testCont.Transient(CtorD)
        });
        
        var objA1 = new CtorA(testCont),
            objC = 'interfaceC';
        objC = testCont.Instance[objC](testCont);
        var objA2 = new CtorA(testCont),
            objA3 = new CtorA(testCont);
        
        
        objA1.doA();
        
        console.log('Expect: call doA() make call to doB() -> ' + trigger);

        objA2.doA();
        objA3.doA();

        console.log('Expect: interfaceB registered as singleton -> ' + (objA1.objB.i == 3));
        
        console.log('Expect: interfaceC registered as other singleton -> ' + (objC.doC() == 'C'));

        var objD1 = 'interfaceD',
            objD2 = 'interfaceD';
        objD1 = testCont.Instance[objD1](testCont);
        objD2 = testCont.Instance[objD2](testCont);
        objD1.prop = 1;
        objD2.prop = 2;

        console.log('Expect: interfaceD registered as transient -> ' + (objD1.prop != objD2.prop));

    };
    
</script>

</html>
